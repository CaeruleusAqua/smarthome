============================
Release 1.9.x - tt. mmm 2022
============================

Es gibt eine Menge neuer Features im Core von SmartHomeNG und den Plugins.

.. note::

    Diese Release Notes sind ein Arbeitsstand.

     - Berücksichtigt sind Commits im smarthome Repository bis incl. 30. Januar 2022
       (lib.scheduler: Removed some development logging)
     - Berücksichtigt sind Commits im plugins Repository bis incl. 30. Januar 2022
       (uzsu plugin: use sun and moon objects of sh and new orb.py)


Überblick
=========

Dieses ist neues Release für SmartHomeNG. Die Änderungen gegenüber dem Release v1.9.x sind im
folgenden in diesen Release Notes beschrieben.


Unterstützte Python Versionen
-----------------------------

Die älteste offiziell unterstützte Python Version für SmartHomeNG Release 1.8 ist Python 3.6.
(Siehe auch *Hard- u. Software Anforderungen* im Abschnitt *Installation* zu unterstützten Python Versionen)

..
    Das bedeutet nicht unbedingt, dass SmartHomeNG ab Release 1.8 nicht mehr unter älteren Python Versionen läuft,
    sondern das SmartHomeNG nicht mehr mit älteren Python Versionen getestet wird und das gemeldete Fehler mit älteren
    Python Versionen nicht mehr zu Buxfixen führen.

    Es werden jedoch zunehmend Features eingesetzt, die erst ab Python 3.6 zur Verfügung stehen.
    So ist Python 3.6 die minimale Vorraussetzung zur Nutzung des neuen Websocket Moduls.


Minimum Python Version
----------------------

Die absolute Minimum Python Version in der SmartHomeNG startet wurde auf v3.6 angehoben, da Python 3.5 im
September 2020 End-of-Life (End of security fixes) gegangen ist. Bei einer Neuinstallation wird jedoch empfohlen
auf einer der neueren Python Versionen (3.7 oder 3.8) aufzusetzen.

.. important::

   Mit dem kommenden Release 1.8 werden die unterstützten Python Versionen
   :doc:`(wie hier beschrieben) </installation/anforderungen>` auf **Python 3.6, 3.7, 3.8** angehoben. Python 3.6
   hat eine Reihe sehr interessanter Features und Verbesserungen gebracht, die dann in SmartHomeNG genutzt
   werden können.

   Sollten solche neuen Features in den Core Einzug halten, wird die **Absolute Minimum Python Version** auf 3.6
   angehoben werden. Sollten die Features nur in Plugins genutzt werden, so können nur solche Plugins nicht genutzt
   werden, wenn eine ältere Python Version als 3.6 eingesetzt wird.


Änderungen am Core
==================

Updates to the CORE
-------------------

* Fixed initialization for cases where logging.yaml contains instructions that thow an exception
  when SmartHomeNG is not fully configured (requirements installed)
* If logging.yaml gives an exception, logging.yaml.default is used

* ...

* Items:

  * ...

* Logics:

  * Logics are now prevented from beeing executed before SmartHomeNG is in Run-Mode (the initialization has finished)
    even if triggerd (by e.g. item initialization) during initialization phase

* Libs:

  * lib.item:

    * introduce new property last_trigger(_by/_age) and prev_trigger(_by/_age) and according functions.
      This way it is possible to figure out what has triggered the eval expression. The property might be
      especially useful inside the eval expression itself but can also be used to figure out what, when
      (or if) an eval got triggered (without being updated, because maybe the eval didn't succeed or the
      value has not changed)
    * Get relative item path: Fix issue where last character of expression part got truncated and therefore
      eval expression might get invalid

  * lib.network:

    * Fix for udp server eventloop too late
    * Pass timeout parameter
    * Add port to connect message
    * Fix validate_inet_addr return for invalid ip
    * Fix for clean shutdown if not connected
    * Added __str__ methods to simplyfy logging

  * lib.orb:

    * Set requirement to ephem max version 4.1.0 because 4.1.3 has a bug or breaking change
    * Fix never up errors with ephem

  * lib.scheduler:

    * Trigger dict in logics contains now the source (cron, cycle) for scheduler triggers
    * Fixed bug where value wasn't set correctly on cron triggers
    * Separated code to start a logic task to is's own method
    * Implemented 'raise LeaveLogic()' for logics
    * Small modification for executing logics
    * Added more details to 'update_by' and 'change_by' on items

  * lib.shpypi:

    * Small fixes

  * lib.smarthome:

    * Change getbasedir for user function to avoid deprecated warning

  * lib.triggertimes:

    * Fix a triggertimes with empty params or wrong parameter set size
    * Enhance debug message 'eventtime is earlier than starttime'


* Modules:

  * http:

    * Added datatables for use in webinterfaces of plugins

  * websocket:

    * Removed "untested" warning from trigger-logic command
    * Loglevel for 'no close frame received or sent' reduced to INFO

* Plugins:

  * ...

* tests:

  * ...


Änderungen bei Plugins
======================

New Plugins
-----------

For details of the changes of the individual plugins, please refer to the documentation of the respective plugin.

* <Name>: ...



Plugin Updates
--------------

* database:

  * Prevent multiple threads for handling database_maxage

* dlms:

  * Enhance returned result
  * Fixed a bug where no response was returned
  * Parameter baudrate will be stored to config now
  * Change parameter name for speed

* enocean:

  * Added support for EEP A5_30_01 and A5_30_03, e.g. water leak sensor
  * Extended plugin webinterface
  * Suggest next free device ID (offset) value during teach-in process
  * New feature "enable/disable logging of unknown devices" via plugin.yaml or WebIf
  * Added tooltips to WebIf

* garminconnect:

  * Fix for login issues, using PyPi package with latest version (4.1.22) now. Still not 100% perfect, due
    to the package implementation. But at least working again
  * Added call to login method before each data retreival to prevent session timeouts
  * Removed broken logout

* gpio:

  * Fix error handling and log on startup
  * Slight improvements in webif concerning datatables

* modbus_tcp:

  * slaveUnit zu Items hinzugefügt
  * slaveUnit-Bug _regToRead-key (adress.unit)
  * bumped version to 1.0.3
  * Bugfix in web interface
  * Fixes in example.yaml

* openweathermap:

  * Add struct for airpollution
  * Bumped to 1.8.4
  * Changed default update cycle to 900 sec to prevent getting locked out by server, if for example
    smartVISU is using the same API key

* philips_tv:

  * Minor improvements for webinterface

* rpi1wire:

  * Udpdate WebIF Tables with new functions
  * Error handling improved
  * Udpdate WebIF Tables with new functions

* smartvisu:

  * Copy info block.html from _templates dir (for sv 3.2 and up)

* sonos:

  * Fix for use with python 3.9 upwards (Thread::isAlive deprecated)
  * Update underlying SoCo library to V_0.25.3

* stateengine:

  * Add gitignore to webif/visualizations folder to make sure folder is created and files in folder are ignored
  * Minor webif update

* telegram:

  * Fix web interface (using default template)
  * Webif support datatables
  * Fix a bug for /info item values

* uzsu:

  * Use sun and moon objects of sh and new orb.py

* viessmann:

  * Fixed log call


Outdated Plugins
----------------

The following plugins were already marked in version v1.6 as *deprecated*. This means that the plugins
are still working, but are not developed further anymore and are removed from the release of SmartHomeNG
in the next release. User of these plugins should switch to corresponding succeeding plugins.

* System Plugins

  * backend - use the administration interface instead
  * sqlite_visu2_8 - switch to the **database** plugin

* Web Plugins

  * wunderground - the free API is not provided anymore by Wunderground


The following plugins are marked as *deprecated* with SmartHomeNG v1.7, because neither user nor tester have been found:

* Gateway Plugins

  * ecmd
  * elro
  * iaqstick
  * snom
  * tellstick

* Interface Plugins

  * easymeter
  * smawb
  * vr100

* Web Plugins

  * nma

Moreover, the previous mqtt plugin was renamed to mqtt1 and marked as *deprecated*, because the new mqtt
plugin takes over the functionality. This plugin is based on the mqtt module and the recent core.


Retired Plugins
---------------

The following plugins have been retired. They had been deprecated in one of the preceding releases of SmartHomeNG.
They have been removed from the plugins repository, but they can still be found on github. Now they reside in
the **plugin_archive** repository from where they can be downloaded if they are still needed.

* ...


Weitere Änderungen
==================

Tools
-----

* ...


Documentation
-------------

* Added "updated_by()" function to reference page
* Consolidated logic documentation to reference section


